# 第5章 运输层
- 重要概念
	1. 运输层为相互通信的应用进程提供**逻辑通信**。
	2. 端口和套接字的意义。
	3. 无连接的UDP的意义。
	4. 面向连接的TCP的特点。
	5. 在不可靠的网络上实现可靠传输的工作原理，停止等待协议和ARQ协议。
	6. TCP的滑动窗口、流量控制、拥塞控制和连接管理。
## 5.1 运输层协议概述
### 5.1.1 进程之间的通信
- 只有**主机**的协议栈才有运输层，而网络核心部分中的**路由器**在转发分组时都只用到下三层的功能
- 从运输层的角度看，通信的真正端点并不是主机而是主机中的进程。**端到端的通信是应用进程之间的通信**
- **复用**（multiplexing）和**分用**（demultiplexing）
- **网络层**为**主机**之间提供逻辑通信，而**运输层**为**应用进程**之间提供端到端的逻辑通信
- 运输层还要对收到的报文进行**差错检查**
- 运输层需要有两种不同的运输协议
	- **面向连接的TCP**，一个全双工的可靠信道
	- **无连接的UDP**，一条不可靠信道
### 5.1.2 运输层的两个主要协议
- TCP/IP运输层的两个主要协议都是互联网的正式标准
	- **用户数据报协议 UDP（User Dategram Protocol）[RFC 768]**
	- **传输控制协议 TCP（Transmission Control Protocol）[RFC 793]**
<table>
    <tr>
        <td colspan="2" align="center">应用层</td>
    </tr>
    <tr>
        <td>UDP</td>
        <td>TCP</td>
    </tr>
    <tr>
        <td colspan="2" align="center">IP</td>
    </tr>
    <tr>
        <td colspan="2" align="center">与各种网络接口</td>
    </tr>
</table>

- TCP/IP体系中的**运输协议数据单元 TPDU（Transport Protocol Data Unit）**
	- **TCP报文段（segment）**
	- **UDP用户数据报**
- UDP在传送数据之前**不需要先建立连接**。远地主机的运输层在收到UDP报文后，不需要给出任何确认（不可靠但是效率高）
- TCP则提供面向连接的服务。在传送数据之前必须先建立连接，数据传送结束后要释放连接。TCP不提供广播或多播服务（可靠且面向连接但开销大）
- 使用UDP和TCP协议的各种应用和应用层协议

| 应用 | 应用层协议 | 运输层协议 |
|--|--|--|
| 名字转换 | DNS（域名系统） | UDP |
| 文件传送 | TFTP（简单文件传送协议） | UDP |
| 路由选择协议 | RIP（路由信息协议） | UDP |
| IP地址配置 | DHCP（动态主机配置协议） | UDP |
| 网络管理 | SNMP（简单网络管理协议） | UDP |
| IP电话 | 专用协议 | UDP |
| 流式多媒体通信 | 专用协议 | UDP |
| 多播 | IGMP（网际组管理协议） | UDP |
| 电子邮件 | SMTP（简单邮件传送协议） | TCP |
| 远程终端接入 | TELNET（远程终端协议） | TCP |
| 万维网 | HTTP（超文本传送协议） | TCP |
| 文件传送 | FTP（文件传送协议） | TCP |
### 5.1.3 运输层的端口
- **协议端口号（protocol port number）**，简称为**端口（port）**
- TCP/IP的运输层用一个16位**端口号**来标志一个端口
- 运输层的端口号
	- **服务器使用的端口号**，是固定的
		- **熟知端口号（well-known port number）**或**系统端口号**，数值为**0~1023**
		- **登记端口号**， 数值为**1024~49151**
	- **客户端使用的端口号**，存在时间是短期的
		- **短暂端口号**，数值为**49152~65535**

| 应用程序 | 熟知端口号 |
|--|--|
| FTP | 21 |
| TELNET | 23 |
| SMTP | 25 |
| DNS | 53 |
| TFTP | 69 |
| HTTP | 80 |
| SNMP | 161 |
| SNMP（trap） | 162 |
| https | 443 |
## 5.2 UDP概述
- UDP的主要特点
	- UDP是**无连接**的
	- UDP使用**尽最大努力交付**，即不保证可靠交付
	- UDP是**面向报文**的，**保留应用层交下来的报文的边界**
	- **UDP没有拥塞控制**
	- **UDP支持一对一、一对多、多对一和多对多的交互通信**
	- **UDP的首部开销小**，只有8个字节
### 5.2.2 UDP的首部格式
- 首部字段，每个字段的长度
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTYzMDg0ODE0OCw5OTUwOTE1ODMsLTEzNj
AwMDkyMzksLTIwOTA0NTE3MTcsMTU2NTg1MDYyLDIwNDcyNTM0
ODEsMjExMTYwMjE1MSwtNTg4NDY3ODkzLDE0OTg1OTU0NTQsNz
M5OTI3ODldfQ==
-->